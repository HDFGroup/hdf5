name: hdf5 dev release

# Controls when the action will run. Triggers the workflow on a schedule
on:
  workflow_call:
    inputs:
      file_base:
        description: "The common base name of the source tarballs"
        required: true
        type: string

# A workflow run is made up of one or more jobs that can run sequentially or
# in parallel
jobs:
  getfiles:
    runs-on: ubuntu-latest
    steps:
      - name: Set file base name
        id: set-file-base
        run: |
          FILE_NAME_BASE=$(echo "${{ inputs.file_base }}")
          echo "FILE_BASE=$FILE_NAME_BASE" >> $GITHUB_OUTPUT

      # Get files created by tarball script
      - name: Get tgz-tarball (Linux)
        uses: actions/download-artifact@v3
        with:
              name: tgz-tarball
              path: ${{ github.workspace }}

      - name: Get zip-tarball (Windows)
        uses: actions/download-artifact@v3
        with:
              name: zip-tarball
              path: ${{ github.workspace }}

      # Get files created by cmake-ctest script
      - name: Get published binary (Windows)
        uses: actions/download-artifact@v3
        with:
              name: zip-vs2022-binary
              path: ${{ github.workspace }}

      - name: Get published binary (MacOS)
        uses: actions/download-artifact@v3
        with:
              name: tgz-osx12-binary
              path: ${{ github.workspace }}

      - name: Get published binary (Linux)
        uses: actions/download-artifact@v3
        with:
              name: tgz-ubuntu-2204-binary
              path: ${{ github.workspace }}

      # Get files used by release script

  PreRelease:
    needs: getfiles
    steps:
      - name: PreRelease tgz-tarball
        uses: softprops/action-gh-release@v1
        with:
          prerelease: true
          files: |
              ${{ steps.set-file-base.outputs.FILE_BASE }}.tar.gz
              ${{ steps.set-file-base.outputs.FILE_BASE }}.zip
              ${{ steps.set-file-base.outputs.FILE_BASE }}-osx12.tar.gz
              ${{ steps.set-file-base.outputs.FILE_BASE }}-ubuntu-2204.tar.gz
              ${{ steps.set-file-base.outputs.FILE_BASE }}-win_vs2022.zip
              if-no-files-found: error # 'warn' or 'ignore' are also available, defaults to `warn`
