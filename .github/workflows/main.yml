name: hdf5 dev CI

# Controls when the action will run. Triggers the workflow on push or pull request
on:
  workflow_dispatch:
  push:
  pull_request:
    branches: [ develop ]
    paths-ignore:
      - '.github/CODEOWNERS'
      - '.github/FUNDING.yml'
      - 'doc/**'
      - 'release_docs/**'
      - 'ACKNOWLEDGEMENTS'
      - 'COPYING**'
      - '**.md'

# Using concurrency to cancel any in-progress job or run
concurrency:
  group: ${{ github.workflow }}-${{ github.sha || github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  contents: read

# A workflow run is made up of one or more jobs that can run sequentially or
# in parallel. We just have one job, but the matrix items defined below will
# run in parallel.
jobs:
  call-workflow-autotools:
    name: "Autotools"
    steps:
      - name: call-workflow-special-autotools:
        uses: ./.github/workflows/main-auto-spc.yml

      - name: call-parallel-special-autotools:
        uses: ./.github/workflows/main-auto-par.yml

      - name: call-debug-thread-autotools:
        uses: ./.github/workflows/main-auto.yml
        with:
            thread_safety: true
            build_mode: "debug"

      - name: call-release-thread-autotools:
        uses: ./.github/workflows/main-auto.yml
        with:
            thread_safety: true
            build_mode: "production"

      - name: call-debug-autotools:
        uses: ./.github/workflows/main-auto.yml
        with:
            thread_safety: false
            build_mode: "debug"

      - name: call-release-autotools:
        uses: ./.github/workflows/main-auto.yml
        with:
            thread_safety: false
            build_mode: "production"

      - name: call-release-auto-intel:
        uses: ./.github/workflows/intel-auto.yml
        with:
            build_mode: "production"

  call-workflow-cmake:
    name: "CMake"
    steps:
      - name: call-debug-thread-cmake:
        uses: ./.github/workflows/main-cmake.yml
        with:
            thread_safety: true
            build_mode: "Debug"

      - name: call-release-thread-cmake:
        uses: ./.github/workflows/main-cmake.yml
        with:
            thread_safety: true
            build_mode: "Release"

      - name: call-debug-cmake:
        uses: ./.github/workflows/main-cmake.yml
        with:
            thread_safety: false
            build_mode: "Debug"

      - name: call-release-cmake:
        uses: ./.github/workflows/main-cmake.yml
        with:
            thread_safety: false
            build_mode: "Release"

      - name: call-release-cmake-intel:
        uses: ./.github/workflows/intel-cmake.yml
        with:
            build_mode: "Release"
