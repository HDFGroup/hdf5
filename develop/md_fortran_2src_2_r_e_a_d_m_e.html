<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HDF5: Information about the Fortran APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="hdf5doxy.css" rel="stylesheet" type="text/css">
<!-- <link href="hdf5doxy.css" rel="stylesheet" type="text/css"/>
 -->
<script type="text/javascript" src="hdf5_navtree_hacks.js"></script>
</head>
<body>
<div style="background:#FFDDDD;font-size:120%;text-align:center;margin:0;padding:5px">Please, help us to better serve our user community by answering the following short survey:  <a href="https://www.hdfgroup.org/website-survey/">https://www.hdfgroup.org/website-survey/</a></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="HDFG-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://www.hdfgroup.org">HDF5</a>
   &#160;<span id="projectnumber">1.15.0.4224aa0</span>
   </div>
   <div id="projectbrief">API Reference</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_fortran_2src_2_r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Information about the Fortran APIs</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains Fortran APIs for HDF5 Library functionality. A complete list of implemented Fortran subroutines can be found in the HDF5 Reference Manual.</p>
<h1><a class="anchor" id="autotoc_md77"></a>
About the source code organization</h1>
<p>The Fortran APIs are organized in modules parallel to the HDF5 Interfaces. Each module is in a separate file with the name H5*ff.F90. Corresponding C stubs are in the H5*f.c files. For example, the Fortran File APIs are in the file <a class="el" href="_h5_fff_8_f90.html">H5Fff.F90</a>, and the corresponding C stubs are in the file H5Ff.c.</p>
<p>Each module contains Fortran definitions of the constants, interfaces to the subroutines if needed, and the subroutines themselves.</p>
<p>It is crucial for users to use constant names in their programs instead of the numerical values, as the constant names have values which are subject to change without notice.</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Quick overview of the Fortran APIs</h1>
<ul>
<li>An in-depth description of each Fortran API and its parameters can be found in the HDF5 Reference Manual. They tend to be summarized from the C descriptions.</li>
<li>The Fortran APIs come in the form of Fortran subroutines.</li>
<li>Each Fortran subroutine name is derived from the corresponding C function name by adding "_f" to the name. For example, the name of the C function to create an HDF5 file is H5Fcreate; the corresponding Fortran subroutine is h5fcreate_f.</li>
<li><p class="startli">The parameter list for each Fortran subroutine usually has two more parameters than the corresponding C function. These additional parameters typically hold the return value and an error code. The order of the Fortran subroutine parameters may differ from the order of the C function parameters.</p>
<p class="startli">The Fortran subroutine parameters are usually listed in the following order:</p><ul>
<li>required input parameters,</li>
<li>output parameters, including return value and error code, and optional input parameters.</li>
</ul>
<p class="startli">For example, the C function to create a dataset has the following prototype: </p><pre class="fragment">hid_t H5Dcreate2(hid_it loc_id, char *name, hid_t type_id,
      hid_t space_id, hid_t link_creation_prp, hid_t dset_creation_prp,
      hid_t dset_access_prop);
</pre><p> The corresponding Fortran subroutine has the following form: </p><pre class="fragment">SUBROUTINE h5dcreate_f(loc_id, name, type_id, space_id, dset_id, &amp;
hdferr, dset_creation_prp, link_creation_prp, dset_access_prop)
</pre><p> The first four parameters of the Fortran subroutine correspond to the parameters of the C function. The fifth parameter, dset_id, is an output parameter containing a valid dataset identifier, and the sixth output parameter, hdferr, indicates successful completion. The error code descriptions can be found in the subroutine descriptions of the Reference Manual. The last three input parameters are optional and can be omitted, in which case default values will be used.</p>
</li>
<li>Parameters to the Fortran subroutines typically include predefined datatypes (see the build-time generated file H5fortran_types.F90 for a complete listing): <pre class="fragment"> INTEGER(HID_T)      compares with hid_t type in HDF5 C APIs
 INTEGER(HSIZE_T)    compares with hsize_t in HDF5 C APIs
 INTEGER(HSSIZE_T)   compares with hssize_t in HDF5 C APIs
 INTEGER(SIZE_T)     compares with the C size_t type
</pre> These integer types usually correspond to 4- or 8-byte integers, depending on the Fortran compiler and corresponding HDF5 C library definitions.</li>
<li>Before calling HDF5 Fortran subroutines, each Fortran application must initialize Fortran datatypes by calling the h5open_f subroutine. After all calls to the HDF5 Fortran Library, the application should call the h5close_f subroutine.</li>
<li>All public APIs for the Reference Manual have Doxygen descriptions and should use parameter aliases when possible.</li>
<li>When a C application reads data stored by a Fortran program, the data appears to be transposed. This is because C and Fortran have different storage orders (row-major and column-major, respectively). For instance, if a Fortran program writes a 4x6 two-dimensional dataset to a file, a C program will read it into memory as a 6x4 two-dimensional dataset. The HDF5 C utilities h5dump and h5ls display transposed data if it was written from a Fortran program.</li>
<li>It is important to note that in Fortran, the indexing of arrays starts at 1.</li>
</ul>
<h1><a class="anchor" id="autotoc_md79"></a>
FOR DEVELOPERS</h1>
<ul>
<li><p class="startli">The build system generates APIs compatible with Fortran 90 to handle the backward compatibility of the older F90 APIs. During the configuration process, the build system determines all valid integer and real KINDs, as well as the maximum decimal precision for reals and floats in both Fortran and C. To determine all the available kinds, the Fortran program <em>PROGRAM FC_AVAIL_KINDS</em> is used, which is located in <a class="el" href="aclocal__fc_8f90.html">aclocal_fc.f90</a>. The available KINDs are stored in H5config_f.inc, a file processed during configuration time from H5config_f.inc.in. Each program in <a class="el" href="aclocal__fc_8f90.html">m4/aclocal_fc.f90</a> is enclosed with a "!---START-----+" line and a "!---END-------+" line, which are used as markers to isolate each test program for the build systems.</p>
<p class="startli">The valid KINDs for integers and reals that are stored in H5config_f.inc are used in the <a class="el" href="_h5__buildiface_8_f90.html">H5_buildiface.F90</a> file located in the fortran/src directory. During the build process, <a class="el" href="_h5__buildiface_8_f90.html">H5_buildiface.F90</a> generates all the valid F90 KIND interfaces for the following APIs: h5awrite_f, h5aread_f, h5dwrite_f, h5dread_f, h5pset_ﬁll_value_f, h5pget_ﬁll_value_f, h5pset_f, h5pget_f, h5pregister_f, and h5pinsert_f. These APIs can handle up to and including rank seven arrays for all the found KINDs. Again, it's important to note that no new Fortran APIs should be added to <a class="el" href="_h5__buildiface_8_f90.html">H5_buildiface.F90</a> since new Fortran APIs should not use F90 specification but should instead use F2003. The source file generated by <a class="el" href="_h5__buildiface_8_f90.html">H5_buildiface.F90</a> is H5_gen.F90, which is the Fortran module H5_GEN, Figure 1. This module is included in the HDF5 module <a class="el" href="_h_d_f5_8_f90.html">HDF5.F90</a>.</p>
</li>
</ul>
<p><img src="./FortBuildFlow.svg" alt="Figure 1: During the configure and build phases, Fortran files are generated and compiled. This overview explains the flow steps of the build process." style="pointer-events: none;" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md80"></a>
Procedure to add a new function</h2>
<blockquote class="doxtable">
<p>&zwj;[!IMPORTANT] <br  />
 The use of C stubs (H5*f.c) is no longer recommended. The C APIs should now be called from Fortran wrappers. C wrappers description exists for maintenance purposes and to create and understand alternative development options. </p>
</blockquote>
<ol type="1">
<li>Edit the fortran/src/H5*ff.F90 file</li>
<li>Edit the fortran/src/H5*f.c file</li>
<li>Edit the fortran/src/H5f90proto.h file</li>
<li>Add the new function to fortran/src/hdf5_fortrandll.def.in</li>
</ol>
<h2><a class="anchor" id="autotoc_md81"></a>
Procedure for passing C variables to Fortran</h2>
<p>(1) Find the C struct name you are interested in: </p><pre class="fragment">    (a) src/H5public.h if it is a generic type, i.e. H5_*
        or
    (b) src/H5*public.h if is a specific type, i.e. H5*_
</pre><p> (2) Put that structure into an array that will be passed to Fortran in: </p><pre class="fragment">    (a) fortran/src/H5_f.c (add to the h5init_flags_c subroutine)
    (b) edit fortran/src/H5f90proto.h and edit h5init_flags_c interface call
</pre><p> (3) Edit the function call in <a class="el" href="_h5__ff_8_f90.html">fortran/src/H5_ff.F90</a> </p><pre class="fragment">    (a) edit the call:  FUNCTION h5init_flags_c
    (b) edit h5init_flags_c call in h5open_f to match the number of arguments being passed
</pre><p> (4) Add the size of the array and array to <a class="el" href="_h5f90global_8_f90.html">fortran/src/H5f90global.F90</a>, it must match the size found in H5_f.c</p>
<blockquote class="doxtable">
<p>&zwj;[!NOTE] <br  />
 To add a default C value argument, do steps (2a) and (4). </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md82"></a>
Procedure for adding a new file to the repository</h2>
<p>Add the name of the file to the: (1) Makefile.am located in the same directory as the new file. (2) CMakeLists.txt located in the same directory as the new file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
