#!/bin/sh
##
# Copyright by The HDF Group.
# Copyright by the Board of Trustees of the University of Illinois.
# All rights reserved.
#
# This file is part of HDF5.  The full HDF5 copyright notice, including
# terms governing use, modification, and redistribution, is contained in
# the files COPYING and Copyright.html.  COPYING can be found at the root
# of the source code distribution tree; Copyright.html can be found at the
# root level of an installed copy of the electronic HDF5 document set and
# is linked from the top-level documents page.  It can also be found at
# http://hdfgroup.org/HDF5/doc/Copyright.html.  If you do not have
# access to either file, you may request a copy from help@hdfgroup.org.
##
# Check that all the configure files are properly genernated.
#
# Programmer: Albert Cheng
# Created Date: 2004/12/07

#
# Configure: should be generated by autoconf version 2.59.
# autoconf:  should be of version 2.59.

# variable initialization
nerrors=0
AUTOCONFVERSION=2.59
AUTOCONFVERSIONLEAD='Generated by GNU Autoconf'
CONFIGUREFILES="configure c++/configure fortran/configure"


# Function definitions
#
# PRINTMSG
# Print a one line message left justified in a field of 70 characters
# without newline.  More output for this line later.
#
PRINTMSG() {
    SPACES="                                                               "
    echo "$* $SPACES" | cut -c1-70 | tr -d '\012'
}

# print result passed.
PASSED() {
    echo " PASSED"
}

# print result failed.
FAILED() {
    echo "*FAILED*"
}


# Main body

# Check configure files
# The autoconf version should be among the first 5 lines.
echo "Check autoconf version. Should be version $AUTOCONFVERSION"
for xf in $CONFIGUREFILES; do
    PRINTMSG $xf
    if [ ! -f $xf ]; then
	FAILED
	echo File not found
	nerrors=`expr $nerrors + 1`
	continue
    fi
    autoconf_version=`head -5 $xf | grep "$AUTOCONFVERSIONLEAD"`
    echo $autoconf_version | grep "$AUTOCONFVERSIONLEAD $AUTOCONFVERSION" > /dev/null 2>&1
    if [ $? -eq 0 ]; then
	PASSED
    else
	FAILED
	echo "Expected: $AUTOCONFVERSIONLEAD $AUTOCONFVERSION"
	echo "Got:      $autoconf_version"
	nerrors=`expr $nerrors + 1`
    fi
done


# Summary
echo $0 found $nerrors errors
if [ $nerrors != 0 ]; then
    exit 1
fi
exit 0
